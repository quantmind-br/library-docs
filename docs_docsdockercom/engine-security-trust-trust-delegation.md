---
title: Delegations for content trust
url: https://docs.docker.com/engine/security/trust/trust_delegation/
source: llms
fetched_at: 2026-01-24T14:25:29.032588258-03:00
rendered_js: false
word_count: 1344
summary: This guide explains how to manage Docker Content Trust delegations and keys to control image signing permissions, including instructions for adding signers, rotating keys, and using the Notary CLI.
tags:
    - docker-content-trust
    - image-signing
    - notary
    - key-management
    - security
    - docker-cli
    - delegations
category: guide
---

Delegations in Docker Content Trust (DCT) allow you to control who can and cannot sign an image tag. A delegation will have a pair of private and public delegation keys. A delegation could contain multiple pairs of keys and contributors in order to a) allow multiple users to be part of a delegation, and b) to support key rotation.

The most important delegation within Docker Content Trust is `targets/releases`. This is seen as the canonical source of a trusted image tag, and without a contributor's key being under this delegation, they will be unable to sign a tag.

Fortunately when using the `$ docker trust` commands, we will automatically initialize a repository, manage the repository keys, and add a collaborator's key to the `targets/releases` delegation via `docker trust signer add`.

By default, the `$ docker trust` commands expect the notary server URL to be the same as the registry URL specified in the image tag (following a similar logic to `$ docker push`). When using Docker Hub or DTR, the notary server URL is the same as the registry URL. However, for self-hosted environments or 3rd party registries, you will need to specify an alternative URL of the notary server. This is done with:

If you do not export this variable in self-hosted environments, you may see errors such as:

If you have enabled authentication for your notary server, or are using DTR, you will need to log in before you can push data to the notary server.

If you do not log in, you will see:

Some of the more advanced features of DCT require the Notary CLI. To install and configure the Notary CLI:

1. Download the [client](https://github.com/theupdateframework/notary/releases) and ensure that it is available on your path.
2. Create a configuration file at `~/.notary/config.json` with the following content:

The newly created configuration file contains information about the location of your local Docker trust data and the notary server URL.

For more detailed information about how to use notary outside of the Docker Content Trust use cases, refer to the [Notary CLI documentation](https://github.com/theupdateframework/notary/blob/master/docs/command_reference.md)

A prerequisite to adding your first contributor is a pair of delegation keys. These keys can either be generated locally using `$ docker trust`, generated by a certificate authority.

### [Using Docker Trust to generate keys](#using-docker-trust-to-generate-keys)

Docker trust has a built-in generator for a delegation key pair, `$ docker trust generate <name>`. Running this command will automatically load the delegation private key in to the local Docker trust store.

### [Manually generating keys](#manually-generating-keys)

If you need to manually generate a private key (either RSA or ECDSA) and an X.509 certificate containing the public key, you can use local tools like openssl or cfssl along with a local or company-wide Certificate Authority.

Here is an example of how to generate a 2048-bit RSA portion key (all RSA keys must be at least 2048 bits):

They should keep `delegation.key` private because it is used to sign tags.

Then they need to generate an x509 certificate containing the public key, which is what you need from them. Here is the command to generate a CSR (certificate signing request):

Then they can send it to whichever CA you trust to sign certificates, or they can self-sign the certificate (in this example, creating a certificate that is valid for 1 year):

Then they need to give you `delegation.crt`, whether it is self-signed or signed by a CA.

Finally you will need to add the private key into your local Docker trust store.

### [Viewing local delegation keys](#viewing-local-delegation-keys)

To list the keys that have been imported in to the local Docker trust store we can use the Notary CLI.

When the first delegation is added to the Notary Server using `$ docker trust`, we automatically initiate trust data for the repository. This includes creating the notary target and snapshots keys, and rotating the snapshot key to be managed by the notary server. More information on these keys can be found in [Manage keys for content trust](https://docs.docker.com/engine/security/trust/trust_key_mng/).

When initiating a repository, you will need the key and the passphrase of a local Notary Canonical Root Key. If you have not initiated a repository before, and therefore don't have a Notary root key, `$ docker trust` will create one for you.

> Be sure to protect and back up your [Notary Canonical Root Key](https://docs.docker.com/engine/security/trust/trust_key_mng/).

### [Initiating the repository](#initiating-the-repository)

To upload the first key to a delegation, at the same time initiating a repository, you can use the `$ docker trust signer add` command. This will add the contributor's public key to the `targets/releases` delegation, and create a second `targets/<name>` delegation.

For DCT the name of the second delegation, in the below example `jeff`, is there to help you keep track of the owner of the keys. In more advanced use cases of Notary additional delegations are used for hierarchy.

You can see which keys have been pushed to the Notary server for each repository with the `$ docker trust inspect` command.

You could also use the Notary CLI to list delegations and keys. Here you can clearly see the keys were attached to `targets/releases` and `targets/jeff`.

### [Adding additional signers](#adding-additional-signers)

Docker Trust allows you to configure multiple delegations per repository, allowing you to manage the lifecycle of delegations. When adding additional delegations with `$ docker trust` the collaborators key is once again added to the `targets/release` role.

> Note you will need the passphrase for the repository key; this would have been configured when you first initiated the repository.

Check to prove that there are now 2 delegations (Signer).

### [Adding keys to an existing delegation](#adding-keys-to-an-existing-delegation)

To support things like key rotation and expiring / retiring keys you can publish multiple contributor keys per delegation. The only prerequisite here is to make sure you use the same the delegation name, in this case `jeff`. Docker trust will automatically handle adding this new key to `targets/releases`.

> You will need the passphrase for the repository key; this would have been configured when you first initiated the repository.

Check to prove that the delegation (Signer) now contains multiple Key IDs.

### [Removing a delegation](#removing-a-delegation)

If you need to remove a delegation, including the contributor keys that are attached to the `targets/releases` role, you can use the `$ docker trust signer remove` command.

> Tags that were signed by the removed delegation will need to be resigned by an active delegation

#### [Troubleshooting](#troubleshooting)

1. If you see an error that there are no usable keys in `targets/releases`, you will need to add additional delegations using `docker trust signer add` before resigning images.
2. If you have added additional delegations already and are seeing an error message that there are no valid signatures in `targest/releases`, you will need to resign the `targets/releases` delegation file with the Notary CLI.
   
   Resigning the delegation file is done with the `$ notary witness` command
   
   For more information on the `notary witness` command, refer to the [Notary client advanced usage guide](https://github.com/theupdateframework/notary/blob/master/docs/advanced_usage.md#recovering-a-delegation)

### [Removing a contributor's key from a delegation](#removing-a-contributors-key-from-a-delegation)

As part of rotating keys for a delegation, you may want to remove an individual key but retain the delegation. This can be done with the Notary CLI.

Remember you will have to remove the key from both the `targets/releases` role and the role specific to that signer `targets/<name>`.

1. We will need to grab the Key ID from the Notary Server
2. Remove from the `targets/releases` delegation
3. Remove from the `targets/<name>` delegation
4. Check the remaining delegation list

### [Removing a local delegation private key](#removing-a-local-delegation-private-key)

As part of rotating delegation keys, you may need to remove a local delegation key from the local Docker trust store. This is done with the Notary CLI, using the `$ notary key remove` command.

1. We will need to get the Key ID from the local Docker Trust store
2. Remove the key from the local Docker Trust store

You can remove all trust data from a repository, including repository, target, snapshot and all delegations keys using the Notary CLI.

This is often required by a container registry before a particular repository can be deleted.

- [Content trust in Docker](https://docs.docker.com/engine/security/trust/)
- [Manage keys for content trust](https://docs.docker.com/engine/security/trust/trust_key_mng/)
- [Automation with content trust](https://docs.docker.com/engine/security/trust/trust_automation/)
- [Play in a content trust sandbox](https://docs.docker.com/engine/security/trust/trust_sandbox/)